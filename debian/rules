#!/usr/bin/make -f

DESTDIR=$(CURDIR)/debian

CONFIG_PATHS=--prefix=/usr \
		--libexecdir=/usr/lib \
		--sysconfdir=/etc \
		--localstatedir=/var/lib

%:
	dh $@ --parallel --with autoreconf

.PHONY: common
common:
	cd common && ./autogen.sh $(CONFIG_PATHS)
	cd common && $(MAKE)

.PHONY: override_dh_autoreconf
override_dh_autoreconf: common
	cd ipmi && ./autogen.sh $(CONFIG_PATHS)
	cd vnfs && ./autogen.sh $(CONFIG_PATHS)

.PHONY: override_dh_auto_build
override_dh_auto_build:
	cd ipmi && $(MAKE)
	cd vnfs && $(MAKE)

.PHONY: override_dh_auto_install
override_dh_auto_install:
	dh_auto_install
	cd common && $(MAKE) DESTDIR=$(DESTDIR)/warewulf3-common install
	cd ipmi && $(MAKE) DESTDIR=$(DESTDIR)/warewulf3-ipmi install
	cd vnfs && $(MAKE) DESTDIR=$(DESTDIR)/warewulf3-vnfs install
	cd $(DESTDIR)/warewulf3-vnfs/usr/lib/warewulf/wwmkchroot && chmod 0664 *.tmpl include-*

